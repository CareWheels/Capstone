angular.module("FredrikSandell.worker-pool",[]).service("WorkerService",["$q",function(a){function b(){var a=["","//try {","var window = self;","self.history = {};","var document = {","      readyState: 'complete',","      cookie: '',","      querySelector: function () {},","      createElement: function () {","          return {","              pathname: '',","              setAttribute: function () {}","          };","      }","};","importScripts('<URL_TO_ANGULAR>');","<CUSTOM_DEP_INCLUDES>","angular = window.angular;","var workerApp = angular.module('WorkerApp', [<DEP_MODULES>]);","workerApp.run(['$q'<STRING_DEP_NAMES>, function ($q<DEP_NAMES>) {","  self.addEventListener('message', function(e) {","    var input = e.data;","    var output = $q.defer();","    var promise = output.promise;","    promise.then(function(success) {","      self.postMessage({event:'success', data : success});","    }, function(reason) {","      self.postMessage({event:'failure', data : reason});","    }, function(update) {","      self.postMessage({event:'update', data : update});","    });","    <WORKER_FUNCTION>;","  });","  self.postMessage({event:'initDone'});","}]);","angular.bootstrap(null, ['WorkerApp']);","//} catch(e) {self.postMessage(JSON.stringify(e));}"];return a.join("\n")}function c(a){var b="";return angular.forEach(a,function(a){i[a]&&(b+="importScripts('"+i[a].url+"');")}),b}function d(a){var b=[];return angular.forEach(a,function(a){i[a]&&b.push("'"+i[a].moduleName+"'")}),b.join(",")}function e(a){var b=a.filter(function(a){return"input"!==a&&"output"!==a&&"$q"!==a}),e={dependencies:b,moduleList:d(b),angularDepsAsStrings:b.length>0?","+b.map(function(a){return"'"+a+"'"}).join(","):"",angularDepsAsParamList:b.length>0?","+b.join(","):"",servicesIncludeStatements:c(b)};return e.workerFuncParamList="input,output"+e.angularDepsAsParamList,e}function f(a,b){return j.replace("<URL_TO_ANGULAR>",h).replace("<CUSTOM_DEP_INCLUDES>",b.servicesIncludeStatements).replace("<DEP_MODULES>",b.moduleList).replace("<STRING_DEP_NAMES>",b.angularDepsAsStrings).replace("<DEP_NAMES>",b.angularDepsAsParamList).replace("<WORKER_FUNCTION>",a.toString())}var g={},h="http://localhost:9876/base/bower_components/angular/angular.js",i={};g.setAngularUrl=function(a){h=a};var j=b();g.addDependency=function(a,b,c){return i[a]={url:c,moduleName:b},g};var k=function(b){var c={};return c.worker=b,c.run=function(c){var d=a.defer();return b.addEventListener("message",function(a){var b=a.data.event;if("initDone"===b)throw"Received worker initialization in run method. This should already have occurred!";"success"===b?d.resolve(a.data.data):"failure"===b?d.reject(a.data.data):"update"===b?d.notify(a.data.data):d.reject(a)}),b.postMessage(c),d.promise},c.terminate=function(){b.terminate()},c},l=function(a){return a.slice(0,a.length-1)},m=function(a,b){return"("+a.toString()+")("+b+")"};return g.createAngularWorker=function(b){if(!Array.isArray(b)||b.length<3||"function"!=typeof b[b.length-1])throw"Input needs to be: ['workerInput','deferredOutput'/*optional additional dependencies*/,\n    function(workerInput, deferredOutput /*optional additional dependencies*/)\n        {/*worker body*/}]";var c=a.defer(),d=e(l(b)),g=(window.webkitURL?webkitURL:URL).createObjectURL(new Blob([f(m(b[b.length-1],d.workerFuncParamList),d)],{type:"application/javascript"})),h=new Worker(g);return h.addEventListener("message",function(a){var b=a.data.event;console.log(a.data),"initDone"===b?c.resolve(k(h)):c.reject(a)}),c.promise},g}]);